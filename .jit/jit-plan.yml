owners:
  default: null
name: My plan
author: Jit
items:
  - name: Scan code for hard-coded secrets
    uses: jitsecurity-controls/jit-plans/items/code/item-secret-detection.yml@latest
level: beginner
version: 0.1
references:
  - https://www.jit.io
tags: []

override:
  workflows:
    github-misconfiguration-access-management-least-privilege:
      jobs:
        chainbench-access-management-least-privilege:
          steps:
          - name: Run chain-bench
            uses: registry.jit.io/control-chain-bench-alpine:sc-22677-chain-bench-control-handle-registry-is-not
            with:
              args: scan -t ${{ jit_secrets.GITHUB_PAT }} -r https://github.com/${{
                context.asset.asset_name }}/${{ context.installation.centralized_repo_asset.asset_name
                }} -o /opt/results.json
              env:
                MODE: org
                SECURITY_CONTROL_OUTPUT_FILE: /opt/results.json
                TEST_IDS: '[ "4.2.5" ]'
    github-misconfiguration-access-management-mfa:
      jobs:
        chainbench-access-management-mfa:
          steps:
          - name: Run chain-bench
            uses: registry.jit.io/control-chain-bench-alpine:sc-22677-chain-bench-control-handle-registry-is-not
            with:
              args: scan -t ${{ jit_secrets.GITHUB_PAT }} -r https://github.com/${{
                context.asset.asset_name }}/${{ context.installation.centralized_repo_asset.asset_name
                }} -o /opt/results.json
              env:
                MODE: org
                SECURITY_CONTROL_OUTPUT_FILE: /opt/results.json
                TEST_IDS: '[ "4.2.3" ]'
    secret-detection:
      jobs:
        secret-detection:
          steps:
          - name: Run Gitleaks
            uses: registry.jit.io/control-gitleaks-alpine:not-hardened-sc-23191-gitleaks-perion-adjust-generic-api-key-rule
            with:
              args: detect --config /config/gitleaks.toml --source ${WORK_DIR:-.} -v --report-format json --report-path $REPORT_FILE --redact --no-git --exit-code 0
              output_file: /tmp/report.json
